<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Canvas Grade & GPA Calculator</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <h1>Canvas GPA Calculator</h1>
      <div class="header-actions">
        <button id="darkModeToggle" class="icon-btn" title="Toggle Dark Mode">
          <span class="dark-mode-icon">üåô</span>
        </button>
        <button id="refreshBtn" class="icon-btn" title="Refresh Data">
          <span class="refresh-icon">‚Üª</span>
        </button>
      </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="tabs">
      <button class="tab active" data-tab="dashboard">Dashboard</button>
      <button class="tab" data-tab="courses">Courses</button>
      <button class="tab" data-tab="settings">Settings</button>
    </nav>

    <!-- Dashboard Tab -->
    <section id="dashboard" class="tab-content active">
      <!-- Connection Status -->
      <div id="connectionStatus" class="status-banner"></div>

      <!-- Last Sync Info -->
      <div id="lastSyncInfo" class="last-sync-info"></div>

      <!-- Semester Filter -->
      <div class="semester-filter">
        <label for="semesterSelect">Semester:</label>
        <select id="semesterSelect">
          <option value="all">All Courses</option>
        </select>
        <button id="manageExcludedBtn" class="btn btn-secondary btn-small" title="Exclude semesters from cumulative GPA">Exclude...</button>
      </div>

      <!-- GPA Summary -->
      <div class="gpa-summary">
        <div class="gpa-card primary">
          <span class="gpa-label">Semester GPA</span>
          <span id="semesterGPA" class="gpa-value clickable" title="Click to override">--</span>
          <span id="semesterCredits" class="gpa-credits clickable" title="Click to edit">0 credits ‚úèÔ∏è</span>
        </div>
        <div class="gpa-card secondary">
          <span class="gpa-label">Cumulative GPA</span>
          <span id="cumulativeGPA" class="gpa-value clickable" title="Click to override">--</span>
          <span id="totalCredits" class="gpa-credits clickable">0 total credits ‚úèÔ∏è</span>
        </div>
      </div>

      <!-- Cumulative GPA Breakdown -->
      <div id="cumulativeBreakdown" class="gpa-breakdown"></div>

      <!-- Academic Standing -->
      <div id="academicStanding" class="standing-card">
        <span class="standing-icon">--</span>
        <span class="standing-text">Calculate your grades to see academic standing</span>
      </div>

      <!-- Target GPA Planner -->
      <div class="target-section">
        <h3>Target GPA Planner</h3>
        <div class="target-input-group">
          <label for="targetGPA">Target Cumulative GPA:</label>
          <input type="number" id="targetGPA" min="0" max="4" step="0.01" placeholder="3.50">
          <button id="calculateTarget" class="btn btn-secondary">Calculate</button>
        </div>
        <div id="targetResult" class="target-result hidden">
          <p id="targetMessage"></p>
        </div>
      </div>

      <!-- Course Impact Preview -->
      <div class="impact-section">
        <h3>Quick Course Impact</h3>
        <p class="help-text">See how improving a course affects your GPA</p>
        <div id="courseImpactList" class="impact-list">
          <p class="placeholder">Connect to Canvas to see courses</p>
        </div>
      </div>

      <!-- Disclaimer -->
      <div class="disclaimer">
        <p>Not affiliated with Canvas or Instructure. For educational purposes only. Always verify grades with official transcripts.</p>
        <p class="created-by">Created by Shawn Georgie</p>
      </div>
    </section>

    <!-- Courses Tab -->
    <section id="courses" class="tab-content">
      <!-- Semester Filter for Courses -->
      <div class="semester-filter">
        <label for="courseSemesterSelect">Semester:</label>
        <select id="courseSemesterSelect">
          <option value="all">All Courses</option>
        </select>
        <button id="addCourseBtn" class="btn btn-primary btn-small">+ Add</button>
      </div>
      <!-- Semester GPA Summary -->
      <div id="coursesGpaSummary" class="courses-gpa-summary">
        <div class="courses-gpa-card">
          <span class="courses-gpa-label">Semester GPA:</span>
          <span id="coursesGpaValue" class="courses-gpa-value">--</span>
          <span id="coursesCreditsValue" class="courses-credits-value clickable" title="Click to edit">0 cr ‚úèÔ∏è</span>
        </div>
      </div>
      <div id="gpaCalculationBreakdown" class="gpa-breakdown"></div>
      <div id="coursesList" class="courses-list">
        <p class="placeholder">Connect to Canvas to view your courses</p>
      </div>
    </section>

    <!-- Settings Tab -->
    <section id="settings" class="tab-content">
      <!-- Canvas API Setup -->
      <div class="settings-section">
        <h3>Canvas API Connection</h3>
        <div class="input-group">
          <label for="canvasUrl">Canvas URL:</label>
          <input type="url" id="canvasUrl" placeholder="https://your-school.instructure.com">
          <small>Your school's Canvas URL</small>
        </div>
        <div class="input-group">
          <label for="apiToken">API Token:</label>
          <input type="password" id="apiToken" placeholder="Enter your Canvas API token">
          <small>
            <a href="#" id="tokenHelp">How to get your token ‚Üí</a>
          </small>
        </div>
        <button id="saveConnection" class="btn btn-primary">Save & Connect</button>
        <button id="testConnection" class="btn btn-secondary">Test Connection</button>
        <div id="connectionTestResult" class="test-result"></div>
      </div>

      <!-- Grading Scale Selection -->
      <div class="settings-section">
        <h3>Grading Scale</h3>
        <p class="help-text">Select your school's grading scale</p>
        <div class="input-group">
          <label for="gradingScaleSelect">Scale:</label>
          <select id="gradingScaleSelect">
            <option value="njit">NJIT (A=4.0, B+=3.5, B=3.0, C+=2.5, C=2.0, D=1.0)</option>
            <option value="plusMinus">Standard Plus/Minus (A=4.0, A-=3.7, B+=3.3...)</option>
            <option value="standard">Standard (A=4.0, B=3.0, C=2.0, D=1.0)</option>
            <option value="custom">Custom Scale</option>
          </select>
        </div>
        <div id="customScaleEditor" class="custom-scale-editor hidden">
          <p class="help-text">Enter grade values (0.0 - 4.0):</p>
          <div class="custom-scale-grid" id="customScaleGrid"></div>
          <button id="saveCustomScale" class="btn btn-secondary btn-small">Save Custom Scale</button>
        </div>
        <div id="currentScalePreview" class="scale-preview"></div>
      </div>

      <!-- Previous GPA Setup -->
      <div class="settings-section">
        <h3>Previous Academic Record</h3>
        <p class="help-text">Enter your GPA and credits from previous semesters to calculate cumulative GPA</p>
        <div class="input-row">
          <div class="input-group">
            <label for="previousGPA">Previous GPA:</label>
            <input type="number" id="previousGPA" min="0" max="4" step="0.01" placeholder="3.50">
          </div>
          <div class="input-group">
            <label for="previousCredits">Previous Credits:</label>
            <input type="number" id="previousCredits" min="0" step="1" placeholder="45">
          </div>
        </div>
        <button id="savePreviousGPA" class="btn btn-primary">Save Previous GPA</button>
      </div>

      <!-- Data Management -->
      <div class="settings-section">
        <h3>Data Management</h3>
        <button id="clearCache" class="btn btn-secondary">Clear Cache</button>
        <button id="exportData" class="btn btn-secondary">Export Data</button>
        <button id="clearAllData" class="btn btn-danger">Clear All Data</button>
      </div>

      <!-- Token Help Modal Content -->
      <div id="tokenHelpContent" class="help-content hidden">
        <h4>How to Get Your Canvas API Token</h4>
        <ol>
          <li>Log in to Canvas</li>
          <li>Go to <strong>Account</strong> (click your profile icon)</li>
          <li>Click <strong>Settings</strong></li>
          <li>Scroll down to <strong>Approved Integrations</strong></li>
          <li>Click <strong>+ New Access Token</strong></li>
          <li>Enter a purpose (e.g., "GPA Calculator")</li>
          <li>Click <strong>Generate Token</strong></li>
          <li>Copy the token and paste it here</li>
        </ol>
        <p class="warning">Keep your token secure! It grants access to your Canvas account.</p>
      </div>
    </section>
  </div>

  <script src="../utils/storage.js"></script>
  <script src="../utils/canvas-api.js"></script>
  <script src="../utils/grading-scale-detector.js"></script>
  <script src="../utils/grade-calculator.js"></script>
  <script src="../utils/gpa-calculator.js"></script>
  <script src="popup.js"></script>
</body>
</html>
